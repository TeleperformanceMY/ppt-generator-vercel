{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/alameer.8/Downloads/ppt-generator-with-power-automate/app/api/generate-ppt/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport PptxGenJS from \"pptxgenjs\"\n\n// ============================================\n// TYPE DEFINITIONS\n// ============================================\n\ninterface TitleSlide {\n  type: \"title\"\n  master: \"TP_TITLE\"\n  title: string\n  subtitle?: string\n}\n\ninterface ChapterSlide {\n  type: \"chapter\"\n  master: \"TP_CHAPTER\"\n  chapterNumber: number\n  title: string\n  chapterImageNumber?: number // 1-33 for dynamic chapter images\n}\n\ninterface ContentSlide {\n  type: \"content\"\n  master: \"TP_CONTENT_WHITE\" | \"TP_CONTENT_BEIGE\"\n  title: string\n  content: string\n}\n\ninterface BulletsSlide {\n  type: \"bullets\"\n  master: \"TP_CONTENT_WHITE\" | \"TP_CONTENT_BEIGE\"\n  title: string\n  items: string[]\n}\n\ninterface TwoColumnSlide {\n  type: \"two-column\"\n  master: \"TP_CONTENT_WHITE\" | \"TP_CONTENT_BEIGE\"\n  title: string\n  leftContent: string\n  rightContent: string\n}\n\ninterface ImageSlide {\n  type: \"image\"\n  master: \"TP_CONTENT_WHITE\" | \"TP_CONTENT_BEIGE\"\n  title: string\n  imageBase64: string\n}\n\ntype Slide = TitleSlide | ChapterSlide | ContentSlide | BulletsSlide | TwoColumnSlide | ImageSlide\n\ninterface PresentationRequest {\n  title: string\n  slides: Slide[]\n  apiKey?: string\n}\n\ninterface PresentationResponse {\n  fileName: string\n  fileBase64: string\n}\n\ninterface ErrorResponse {\n  error: string\n  code: string\n  details?: string\n}\n\n// ============================================\n// CONFIGURATION\n// ============================================\n\nconst VALID_API_KEY = process.env.PPT_API_KEY || null\nconst MAX_PAYLOAD_SIZE = 10 * 1024 * 1024\n\n// TP Brand Colors\nconst TP_COLORS = {\n  black: \"000000\",\n  white: \"FFFFFF\",\n  beige: \"D4D1CA\",\n  darkGray: \"4A4C6A\",\n  pink: \"ED1E81\",\n  taupe: \"918D80\",\n}\n\nconst STATIC_ASSET_BASE_URL = process.env.STATIC_ASSET_BASE_URL || \"http://localhost:3000\"\nconst LOGO_WHITE_URL = \"/images/gmt-logo-20tp-rgb-feb-202025-white.png\"\nconst LOGO_BLACK_URL = \"/images/gmt-logo-20tp-rgb-feb-202025-black.png\"\n\n// Chapter images base URL - set this env var to your Vercel blob storage URL\n// Example: https://yourdomain.com/images/chapter/\n// Images should be named: image1.png, image2.jpg, etc. (1-33)\nconst CHAPTER_IMAGE_BASE_URL = process.env.CHAPTER_IMAGE_BASE_URL || \"\"\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction resolveAssetUrl(url: string) {\n  if (url.startsWith(\"http://\") || url.startsWith(\"https://\")) {\n    return url\n  }\n  try {\n    return new URL(url, STATIC_ASSET_BASE_URL).toString()\n  } catch {\n    return url\n  }\n}\n\nasync function fetchImageAsBase64(url: string): Promise<string | null> {\n  try {\n    const response = await fetch(resolveAssetUrl(url))\n    if (!response.ok) return null\n    const arrayBuffer = await response.arrayBuffer()\n    const base64 = Buffer.from(arrayBuffer).toString(\"base64\")\n    const contentType = response.headers.get(\"content-type\") || \"image/png\"\n    return `data:${contentType};base64,${base64}`\n  } catch (error) {\n    console.error(\"Failed to fetch image:\", url, error)\n    return null\n  }\n}\n\nasync function getChapterImageUrl(imageNumber: number): Promise<string | null> {\n  if (!CHAPTER_IMAGE_BASE_URL || imageNumber < 1 || imageNumber > 33) {\n    return null\n  }\n\n  // Try different extensions\n  const extensions = [\"png\", \"jpg\", \"jpeg\"]\n  for (const ext of extensions) {\n    const url = `${CHAPTER_IMAGE_BASE_URL}/image${imageNumber}.${ext}`\n    try {\n      const response = await fetch(url, { method: \"HEAD\" })\n      if (response.ok) {\n        return url\n      }\n    } catch {\n      continue\n    }\n  }\n  return null\n}\n\n// ============================================\n// SLIDE MASTER DEFINITIONS\n// ============================================\n\nfunction defineSlideMasters(pptx: PptxGenJS): void {\n  // TP_TITLE - Black background title slide\n  pptx.defineSlideMaster({\n    title: \"TP_TITLE\",\n    background: { color: TP_COLORS.black },\n  })\n\n  // TP_CHAPTER - Chapter divider slide\n  pptx.defineSlideMaster({\n    title: \"TP_CHAPTER\",\n    background: { color: TP_COLORS.black },\n  })\n\n  // TP_CONTENT_WHITE - White background content\n  pptx.defineSlideMaster({\n    title: \"TP_CONTENT_WHITE\",\n    background: { color: TP_COLORS.white },\n    slideNumber: { x: 9.3, y: 5.2, color: TP_COLORS.darkGray, fontSize: 10 },\n  })\n\n  // TP_CONTENT_BEIGE - Beige background content\n  pptx.defineSlideMaster({\n    title: \"TP_CONTENT_BEIGE\",\n    background: { color: TP_COLORS.beige },\n    slideNumber: { x: 9.3, y: 5.2, color: TP_COLORS.darkGray, fontSize: 10 },\n  })\n}\n\n// ============================================\n// SLIDE BUILDERS\n// ============================================\n\nasync function addTitleSlide(pptx: PptxGenJS, slide: TitleSlide): Promise<void> {\n  const pptSlide = pptx.addSlide({ masterName: \"TP_TITLE\" })\n\n  // Main title\n  pptSlide.addText(slide.title, {\n    x: 0.5,\n    y: 2.2,\n    w: 9,\n    h: 1.2,\n    fontSize: 44,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.white,\n    bold: true,\n    align: \"left\",\n    valign: \"middle\",\n  })\n\n  // Subtitle\n  if (slide.subtitle) {\n    pptSlide.addText(slide.subtitle, {\n      x: 0.5,\n      y: 3.4,\n      w: 9,\n      h: 0.8,\n      fontSize: 24,\n      fontFace: \"Calibri Light\",\n      color: TP_COLORS.beige,\n      align: \"left\",\n      valign: \"middle\",\n    })\n  }\n\n  // Add white logo\n  const logoBase64 = await fetchImageAsBase64(LOGO_WHITE_URL)\n  if (logoBase64) {\n    pptSlide.addImage({\n      data: logoBase64,\n      x: 0.3,\n      y: 4.8,\n      w: 0.5,\n      h: 0.5,\n    })\n  }\n\n  // Add tp.com text\n  pptSlide.addText(\"tp.com\", {\n    x: 0.85,\n    y: 4.95,\n    w: 1,\n    h: 0.3,\n    fontSize: 10,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.white,\n  })\n}\n\nasync function addChapterSlide(pptx: PptxGenJS, slide: ChapterSlide): Promise<void> {\n  const pptSlide = pptx.addSlide({ masterName: \"TP_CHAPTER\" })\n\n  // Large chapter number (formatted as 01, 02, etc.)\n  const formattedNumber = slide.chapterNumber.toString().padStart(2, \"0\")\n  pptSlide.addText(formattedNumber, {\n    x: 0.5,\n    y: 1.5,\n    w: 3,\n    h: 2,\n    fontSize: 120,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.white,\n    bold: true,\n  })\n\n  // Chapter title\n  pptSlide.addText(slide.title, {\n    x: 0.5,\n    y: 3.5,\n    w: 5,\n    h: 1,\n    fontSize: 32,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.white,\n    bold: true,\n  })\n\n  // Add chapter image if specified\n  if (slide.chapterImageNumber && CHAPTER_IMAGE_BASE_URL) {\n    const imageUrl = await getChapterImageUrl(slide.chapterImageNumber)\n    if (imageUrl) {\n      const imageBase64 = await fetchImageAsBase64(imageUrl)\n      if (imageBase64) {\n        pptSlide.addImage({\n          data: imageBase64,\n          x: 5.5,\n          y: 0.5,\n          w: 4,\n          h: 4.5,\n          sizing: { type: \"contain\", w: 4, h: 4.5 },\n        })\n      }\n    }\n  }\n\n  // Add white logo\n  const logoBase64 = await fetchImageAsBase64(LOGO_WHITE_URL)\n  if (logoBase64) {\n    pptSlide.addImage({\n      data: logoBase64,\n      x: 0.3,\n      y: 4.8,\n      w: 0.5,\n      h: 0.5,\n    })\n  }\n\n  pptSlide.addText(\"tp.com\", {\n    x: 0.85,\n    y: 4.95,\n    w: 1,\n    h: 0.3,\n    fontSize: 10,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.white,\n  })\n}\n\nasync function addContentSlide(pptx: PptxGenJS, slide: ContentSlide): Promise<void> {\n  const pptSlide = pptx.addSlide({ masterName: slide.master })\n  const isBeige = slide.master === \"TP_CONTENT_BEIGE\"\n  const textColor = TP_COLORS.black\n\n  // Title\n  pptSlide.addText(slide.title, {\n    x: 0.5,\n    y: 0.3,\n    w: 9,\n    h: 0.6,\n    fontSize: 28,\n    fontFace: \"Calibri\",\n    color: textColor,\n    bold: true,\n  })\n\n  // Content\n  pptSlide.addText(slide.content, {\n    x: 0.5,\n    y: 1.2,\n    w: 9,\n    h: 3.5,\n    fontSize: 16,\n    fontFace: \"Calibri Light\",\n    color: textColor,\n    valign: \"top\",\n    paraSpaceAfter: 12,\n  })\n\n  // Add black logo\n  const logoBase64 = await fetchImageAsBase64(LOGO_BLACK_URL)\n  if (logoBase64) {\n    pptSlide.addImage({\n      data: logoBase64,\n      x: 0.3,\n      y: 4.8,\n      w: 0.5,\n      h: 0.5,\n    })\n  }\n\n  pptSlide.addText(\"tp.com\", {\n    x: 0.85,\n    y: 4.95,\n    w: 1,\n    h: 0.3,\n    fontSize: 10,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.darkGray,\n  })\n}\n\nasync function addBulletsSlide(pptx: PptxGenJS, slide: BulletsSlide): Promise<void> {\n  const pptSlide = pptx.addSlide({ masterName: slide.master })\n  const textColor = TP_COLORS.black\n\n  // Title\n  pptSlide.addText(slide.title, {\n    x: 0.5,\n    y: 0.3,\n    w: 9,\n    h: 0.6,\n    fontSize: 28,\n    fontFace: \"Calibri\",\n    color: textColor,\n    bold: true,\n  })\n\n  // Bullet points\n  const bulletItems = slide.items.map((item) => ({\n    text: item,\n    options: {\n      bullet: { type: \"bullet\" as const, color: TP_COLORS.pink },\n      paraSpaceBefore: 8,\n      paraSpaceAfter: 8,\n    },\n  }))\n\n  pptSlide.addText(bulletItems, {\n    x: 0.5,\n    y: 1.2,\n    w: 9,\n    h: 3.5,\n    fontSize: 18,\n    fontFace: \"Calibri Light\",\n    color: textColor,\n    valign: \"top\",\n  })\n\n  // Add black logo\n  const logoBase64 = await fetchImageAsBase64(LOGO_BLACK_URL)\n  if (logoBase64) {\n    pptSlide.addImage({\n      data: logoBase64,\n      x: 0.3,\n      y: 4.8,\n      w: 0.5,\n      h: 0.5,\n    })\n  }\n\n  pptSlide.addText(\"tp.com\", {\n    x: 0.85,\n    y: 4.95,\n    w: 1,\n    h: 0.3,\n    fontSize: 10,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.darkGray,\n  })\n}\n\nasync function addTwoColumnSlide(pptx: PptxGenJS, slide: TwoColumnSlide): Promise<void> {\n  const pptSlide = pptx.addSlide({ masterName: slide.master })\n  const textColor = TP_COLORS.black\n\n  // Title\n  pptSlide.addText(slide.title, {\n    x: 0.5,\n    y: 0.3,\n    w: 9,\n    h: 0.6,\n    fontSize: 28,\n    fontFace: \"Calibri\",\n    color: textColor,\n    bold: true,\n  })\n\n  // Left column\n  pptSlide.addText(slide.leftContent, {\n    x: 0.5,\n    y: 1.2,\n    w: 4.3,\n    h: 3.5,\n    fontSize: 16,\n    fontFace: \"Calibri Light\",\n    color: textColor,\n    valign: \"top\",\n  })\n\n  // Right column\n  pptSlide.addText(slide.rightContent, {\n    x: 5.2,\n    y: 1.2,\n    w: 4.3,\n    h: 3.5,\n    fontSize: 16,\n    fontFace: \"Calibri Light\",\n    color: textColor,\n    valign: \"top\",\n  })\n\n  // Add black logo\n  const logoBase64 = await fetchImageAsBase64(LOGO_BLACK_URL)\n  if (logoBase64) {\n    pptSlide.addImage({\n      data: logoBase64,\n      x: 0.3,\n      y: 4.8,\n      w: 0.5,\n      h: 0.5,\n    })\n  }\n\n  pptSlide.addText(\"tp.com\", {\n    x: 0.85,\n    y: 4.95,\n    w: 1,\n    h: 0.3,\n    fontSize: 10,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.darkGray,\n  })\n}\n\nasync function addImageSlide(pptx: PptxGenJS, slide: ImageSlide): Promise<void> {\n  const pptSlide = pptx.addSlide({ masterName: slide.master })\n  const textColor = TP_COLORS.black\n\n  // Title\n  pptSlide.addText(slide.title, {\n    x: 0.5,\n    y: 0.3,\n    w: 9,\n    h: 0.6,\n    fontSize: 28,\n    fontFace: \"Calibri\",\n    color: textColor,\n    bold: true,\n  })\n\n  // Image\n  const imageData = slide.imageBase64.includes(\"base64,\")\n    ? slide.imageBase64\n    : `data:image/png;base64,${slide.imageBase64}`\n\n  pptSlide.addImage({\n    data: imageData,\n    x: 1,\n    y: 1.2,\n    w: 8,\n    h: 3.5,\n    sizing: { type: \"contain\", w: 8, h: 3.5 },\n  })\n\n  // Add black logo\n  const logoBase64 = await fetchImageAsBase64(LOGO_BLACK_URL)\n  if (logoBase64) {\n    pptSlide.addImage({\n      data: logoBase64,\n      x: 0.3,\n      y: 4.8,\n      w: 0.5,\n      h: 0.5,\n    })\n  }\n\n  pptSlide.addText(\"tp.com\", {\n    x: 0.85,\n    y: 4.95,\n    w: 1,\n    h: 0.3,\n    fontSize: 10,\n    fontFace: \"Calibri\",\n    color: TP_COLORS.darkGray,\n  })\n}\n\n// ============================================\n// VALIDATION\n// ============================================\n\nfunction validateRequest(\n  data: unknown,\n): { valid: true; data: PresentationRequest } | { valid: false; error: ErrorResponse } {\n  if (!data || typeof data !== \"object\") {\n    return {\n      valid: false,\n      error: {\n        error: \"Invalid request body\",\n        code: \"INVALID_BODY\",\n        details: \"Request body must be a valid JSON object\",\n      },\n    }\n  }\n\n  const req = data as Record<string, unknown>\n\n  if (!req.title || typeof req.title !== \"string\") {\n    return {\n      valid: false,\n      error: {\n        error: \"Missing or invalid title\",\n        code: \"INVALID_TITLE\",\n        details: \"The 'title' field must be a non-empty string\",\n      },\n    }\n  }\n\n  if (!Array.isArray(req.slides) || req.slides.length === 0) {\n    return {\n      valid: false,\n      error: {\n        error: \"Missing or invalid slides\",\n        code: \"INVALID_SLIDES\",\n        details: \"The 'slides' field must be a non-empty array\",\n      },\n    }\n  }\n\n  const validTypes = [\"title\", \"chapter\", \"content\", \"bullets\", \"two-column\", \"image\"]\n  const validMasters = [\"TP_TITLE\", \"TP_CHAPTER\", \"TP_CONTENT_WHITE\", \"TP_CONTENT_BEIGE\"]\n\n  for (let i = 0; i < req.slides.length; i++) {\n    const slide = req.slides[i] as Record<string, unknown>\n\n    if (!slide.type || !validTypes.includes(slide.type as string)) {\n      return {\n        valid: false,\n        error: {\n          error: `Invalid slide type at index ${i}`,\n          code: \"INVALID_SLIDE_TYPE\",\n          details: `Slide type must be one of: ${validTypes.join(\", \")}`,\n        },\n      }\n    }\n\n    if (!slide.master || !validMasters.includes(slide.master as string)) {\n      return {\n        valid: false,\n        error: {\n          error: `Invalid master at index ${i}`,\n          code: \"INVALID_MASTER\",\n          details: `Master must be one of: ${validMasters.join(\", \")}`,\n        },\n      }\n    }\n\n    if (!slide.title || typeof slide.title !== \"string\") {\n      return {\n        valid: false,\n        error: {\n          error: `Missing title in slide at index ${i}`,\n          code: \"MISSING_SLIDE_TITLE\",\n        },\n      }\n    }\n\n    // Type-specific validation\n    if (slide.type === \"content\" && typeof slide.content !== \"string\") {\n      return {\n        valid: false,\n        error: {\n          error: `Missing content in content slide at index ${i}`,\n          code: \"MISSING_CONTENT\",\n        },\n      }\n    }\n\n    if (slide.type === \"bullets\" && !Array.isArray(slide.items)) {\n      return {\n        valid: false,\n        error: {\n          error: `Missing items array in bullets slide at index ${i}`,\n          code: \"MISSING_ITEMS\",\n        },\n      }\n    }\n\n    if (slide.type === \"chapter\" && typeof slide.chapterNumber !== \"number\") {\n      return {\n        valid: false,\n        error: {\n          error: `Missing chapterNumber in chapter slide at index ${i}`,\n          code: \"MISSING_CHAPTER_NUMBER\",\n        },\n      }\n    }\n\n    if (slide.type === \"two-column\") {\n      if (typeof slide.leftContent !== \"string\" || typeof slide.rightContent !== \"string\") {\n        return {\n          valid: false,\n          error: {\n            error: `Missing leftContent or rightContent in two-column slide at index ${i}`,\n            code: \"MISSING_COLUMN_CONTENT\",\n          },\n        }\n      }\n    }\n\n    if (slide.type === \"image\" && typeof slide.imageBase64 !== \"string\") {\n      return {\n        valid: false,\n        error: {\n          error: `Missing imageBase64 in image slide at index ${i}`,\n          code: \"MISSING_IMAGE\",\n        },\n      }\n    }\n  }\n\n  return { valid: true, data: req as unknown as PresentationRequest }\n}\n\n// ============================================\n// MAIN API HANDLER\n// ============================================\n\nexport async function POST(request: NextRequest): Promise<NextResponse<PresentationResponse | ErrorResponse>> {\n  try {\n    const contentLength = request.headers.get(\"content-length\")\n    if (contentLength && Number.parseInt(contentLength) > MAX_PAYLOAD_SIZE) {\n      return NextResponse.json(\n        {\n          error: \"Payload too large\",\n          code: \"PAYLOAD_TOO_LARGE\",\n          details: `Maximum payload size is ${MAX_PAYLOAD_SIZE / 1024 / 1024}MB`,\n        },\n        { status: 413 },\n      )\n    }\n\n    let body: unknown\n    try {\n      body = await request.json()\n    } catch {\n      return NextResponse.json(\n        {\n          error: \"Invalid JSON\",\n          code: \"INVALID_JSON\",\n          details: \"Request body must be valid JSON\",\n        },\n        { status: 400 },\n      )\n    }\n\n    if (VALID_API_KEY) {\n      const apiKey = (body as Record<string, unknown>)?.apiKey || request.headers.get(\"x-api-key\")\n      if (apiKey !== VALID_API_KEY) {\n        return NextResponse.json(\n          {\n            error: \"Unauthorized\",\n            code: \"UNAUTHORIZED\",\n            details: \"Invalid or missing API key\",\n          },\n          { status: 401 },\n        )\n      }\n    }\n\n    const validation = validateRequest(body)\n    if (!validation.valid) {\n      return NextResponse.json(validation.error, { status: 400 })\n    }\n\n    const { title, slides } = validation.data\n\n    const pptx = new PptxGenJS()\n    pptx.title = title\n    pptx.author = \"TP PPT Generator\"\n    pptx.company = \"Teleperformance\"\n    pptx.layout = \"LAYOUT_16x9\"\n\n    defineSlideMasters(pptx)\n\n    // Build slides (async for image fetching)\n    for (const slide of slides) {\n      switch (slide.type) {\n        case \"title\":\n          await addTitleSlide(pptx, slide)\n          break\n        case \"chapter\":\n          await addChapterSlide(pptx, slide)\n          break\n        case \"content\":\n          await addContentSlide(pptx, slide)\n          break\n        case \"bullets\":\n          await addBulletsSlide(pptx, slide)\n          break\n        case \"two-column\":\n          await addTwoColumnSlide(pptx, slide)\n          break\n        case \"image\":\n          await addImageSlide(pptx, slide)\n          break\n      }\n    }\n\n    const base64Data = await pptx.write({ outputType: \"base64\" })\n    const sanitizedTitle = title.replace(/[^a-zA-Z0-9]/g, \"_\").substring(0, 50)\n    const fileName = `${sanitizedTitle}_${Date.now()}.pptx`\n\n    return NextResponse.json({\n      fileName,\n      fileBase64: base64Data as string,\n    })\n  } catch (error) {\n    console.error(\"PPT Generation Error:\", error)\n    return NextResponse.json(\n      {\n        error: \"Internal server error\",\n        code: \"INTERNAL_ERROR\",\n        details: error instanceof Error ? error.message : \"Unknown error occurred\",\n      },\n      { status: 500 },\n    )\n  }\n}\n\nexport async function GET(): Promise<NextResponse> {\n  return NextResponse.json({\n    status: \"ok\",\n    service: \"TP PPT Generator API\",\n    version: \"2.0.0\",\n    endpoints: {\n      POST: \"/api/generate-ppt\",\n    },\n    supportedSlideTypes: [\"title\", \"chapter\", \"content\", \"bullets\", \"two-column\", \"image\"],\n    slideMasters: [\"TP_TITLE\", \"TP_CHAPTER\", \"TP_CONTENT_WHITE\", \"TP_CONTENT_BEIGE\"],\n    chapterImagesConfigured: !!CHAPTER_IMAGE_BASE_URL,\n  })\n}\n"],"names":[],"mappings":"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"}}]
}